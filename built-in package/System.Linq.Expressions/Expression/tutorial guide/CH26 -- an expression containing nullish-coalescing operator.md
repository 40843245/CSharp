# CH26 -- an expression containing nullish-coalescing operator
## objectives
You will learn how to

+ create an expression containing nullish-coalescing operator

## CH26.1 -- an expression containing nullish-coalescing operator
### `Expression.Coalesce` static method
To create an expression containing nullish-coalescing operator (`??`) in `.NET Framework`,

just simply invoke `Expression.Coalesce` static method.

## examples
### example 1
+ The following example illstrate an expression about `nullish-coalescing` operator (`??`).

+ In the following sub-example 1 in following example,

After the expression is compiled, it will become like this

In `C#`,

```
output = input ?? "DefaultValue"
```

+ In the following sub-example 2 in following example,

After the expression is compiled, it will become like this

In `C#`,

```
output = input ?? 0
```

Invoking following method

```
        /// <summary>
        /// illustrate an expression about nullish coalescing operation (`??`) -- `Expression.Coalesce`.
        /// </summary>
        public static void TestMethod45()
        {
            Console.WriteLine("In {0} method call," , MethodBase.GetCurrentMethod().Name);

            //* ----------------- Example with a string with null value ----------------------- *//
            // 1. Define an Expression for a potentially null string
            ParameterExpression inputString = Expression.Parameter(typeof(string) , "input");

            // 2. Define an Expression for the default value
            ConstantExpression defaultValue = Expression.Constant("Default Value" , typeof(string));

            // 3. Create the Coalesce Expression: input ?? "Default Value"
            // The first argument to Expression.Coalesce must be nullable.
            // If it's a value type, it needs to be a Nullable<T>.
            // For reference types like string, it's inherently nullable.
            BinaryExpression coalesceExpression = Expression.Coalesce(inputString , defaultValue);

            // 4. Compile the expression into a callable delegate
            Func<string , string> coalesceFunc = Expression.Lambda<Func<string , string>>(coalesceExpression , inputString).Compile();

            // 5. Test cases
            string test1 = "Hello World";
            string result1 = coalesceFunc(test1);
            Console.WriteLine($"Input: \"{test1}\", Result: \"{result1}\"");

            string test2 = null;
            string result2 = coalesceFunc(test2);
            Console.WriteLine($"Input: null, Result: \"{result2}\"");

            //* ----------------- Example with a Nullable<int> ----------------------- *//
            ParameterExpression inputInt = Expression.Parameter(typeof(int?) , "inputInt");
            ConstantExpression defaultInt = Expression.Constant(0 , typeof(int?)); // Must be Nullable<int> for the default as well
            BinaryExpression coalesceIntExpression = Expression.Coalesce(inputInt , defaultInt);
            Func<int? , int?> coalesceIntFunc = Expression.Lambda<Func<int? , int?>>(coalesceIntExpression , inputInt).Compile();

            int? intTest1 = 123;
            int? intResult1 = coalesceIntFunc(intTest1);
            Console.WriteLine($"Input: {intTest1}, Result: {intResult1}"); // Output: Input: 123, Result: 123

            int? intTest2 = null;
            int? intResult2 = coalesceIntFunc(intTest2);
            Console.WriteLine($"Input: null, Result: {intResult2}");
        }
```

will output following

```
In TestMethod45 method call,
Input: "Hello World", Result: "Hello World"
Input: null, Result: "Default Value"
Input: 123, Result: 123
Input: null, Result: 0
```

## reference
### API docs
+ [`Expression.Coalesce Method`](https://learn.microsoft.com/en-us/dotnet/api/system.linq.expressions.expression.coalesce?view=net-8.0)

### examples
+ The code in example 1 are generated by [Google Gemini Flash 2.5](https://g.co/gemini/share/9a57b59ee559)